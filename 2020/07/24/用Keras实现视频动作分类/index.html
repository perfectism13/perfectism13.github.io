<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 4.2.1">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"perfectism13.github.io","root":"/","scheme":"Pisces","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":true,"show_result":true,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":true},"bookmark":{"enable":true,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":"gitalk","storage":true,"lazyload":false,"nav":null,"activeClass":"gitalk"},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":5,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="用Keras实现视频动作分类使用LSTM或者RNN处理时序信息太费时间 所以我们先训练一个用于图片上运动信息分类的CNN，通过采用一种滚动平均的方法将其应用在视频分类中">
<meta property="og:type" content="article">
<meta property="og:title" content="用Keras实现视频动作分类">
<meta property="og:url" content="https://perfectism13.github.io/2020/07/24/%E7%94%A8Keras%E5%AE%9E%E7%8E%B0%E8%A7%86%E9%A2%91%E5%8A%A8%E4%BD%9C%E5%88%86%E7%B1%BB/index.html">
<meta property="og:site_name" content="perfectism&#39;s blog">
<meta property="og:description" content="用Keras实现视频动作分类使用LSTM或者RNN处理时序信息太费时间 所以我们先训练一个用于图片上运动信息分类的CNN，通过采用一种滚动平均的方法将其应用在视频分类中">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2020-07-24T05:10:01.150Z">
<meta property="article:modified_time" content="2020-07-24T05:45:34.164Z">
<meta property="article:author" content="Chenyang Min">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="https://perfectism13.github.io/2020/07/24/%E7%94%A8Keras%E5%AE%9E%E7%8E%B0%E8%A7%86%E9%A2%91%E5%8A%A8%E4%BD%9C%E5%88%86%E7%B1%BB/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>

  <title>用Keras实现视频动作分类 | perfectism's blog</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">perfectism's blog</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">物来顺应，未来不迎，当时不杂，既往不恋</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
        <li class="menu-item menu-item-schedule">

    <a href="/schedule/" rel="section"><i class="fa fa-calendar fa-fw"></i>日程表</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>
  <div class="reading-progress-bar"></div>
  <a role="button" class="book-mark-link book-mark-link-fixed"></a>

  <a href="https://github.com/perfectism13" class="github-corner" title="Follow me on GitHub" aria-label="Follow me on GitHub" rel="noopener" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://perfectism13.github.io/2020/07/24/%E7%94%A8Keras%E5%AE%9E%E7%8E%B0%E8%A7%86%E9%A2%91%E5%8A%A8%E4%BD%9C%E5%88%86%E7%B1%BB/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Chenyang Min">
      <meta itemprop="description" content="Computer Vision, Deep Learning">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="perfectism's blog">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          用Keras实现视频动作分类
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2020-07-24 13:10:01 / 修改时间：13:45:34" itemprop="dateCreated datePublished" datetime="2020-07-24T13:10:01+08:00">2020-07-24</time>
            </span>

          
            <span class="post-meta-item" title="阅读次数" id="busuanzi_container_page_pv" style="display: none;">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span id="busuanzi_value_page_pv"></span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <h1 id="用Keras实现视频动作分类"><a href="#用Keras实现视频动作分类" class="headerlink" title="用Keras实现视频动作分类"></a>用Keras实现视频动作分类</h1><p>使用LSTM或者RNN处理时序信息太费时间</p>
<p>所以我们先训练一个用于图片上运动信息分类的CNN，通过采用一种滚动平均的方法将其应用在视频分类中</p>
<a id="more"></a>
<h3 id="普通方法"><a href="#普通方法" class="headerlink" title="普通方法"></a>普通方法</h3><ol>
<li>Loop over all frames in the video file</li>
<li>For each frame, pass the frame through the CNN</li>
<li>Classify each frame <em>individually</em> and <em>independently</em> of each other</li>
<li>Choose the label with the largest corresponding probability</li>
<li>Label the frame and write the output frame to disk</li>
</ol>
<p>if you’ve ever tried to apply simple image classification to video classification you likely encountered a sort of <strong>“prediction flickering”</strong>（预测闪烁）</p>
<p>因此如何避免CNN模型在两个标签之间闪烁很重要</p>
<h3 id="使用滚动平均方法（rolling-prediction-average）"><a href="#使用滚动平均方法（rolling-prediction-average）" class="headerlink" title="使用滚动平均方法（rolling prediction average）"></a>使用滚动平均方法（<strong>rolling prediction average</strong>）</h3><p>假设视频里的随后几帧含有相同的语义内容</p>
<ol>
<li>Loop over all frames in the video file</li>
<li>For each frame, pass the frame through the CNN</li>
<li>Obtain the predictions from the CNN</li>
<li>Maintain a list of the last <em>K</em> predictions</li>
<li>Compute the average of the last <em>K</em> predictions and choose the label with the largest corresponding probability（假设每个视频帧有三个概率输出，则将3xK平均为单个3，然后取概率最大的标签）</li>
<li>Label the frame and write the output frame to disk</li>
</ol>
<h2 id="代码实现"><a href="#代码实现" class="headerlink" title="代码实现"></a>代码实现</h2><p>代码链接：</p>
<p><a href="https://github.com/perfectism13/learning_colab" target="_blank" rel="noopener">https://github.com/perfectism13/learning_colab</a></p>
<h3 id="前期准备"><a href="#前期准备" class="headerlink" title="前期准备"></a>前期准备</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">from google.colab import drive</span><br><span class="line">drive.mount(&#39;&#x2F;content&#x2F;drive&#39;)</span><br><span class="line">import os</span><br><span class="line">os.chdir(r&#39;&#x2F;content&#x2F;drive&#x2F;My Drive&#x2F;colab&#x2F;keras-video-classification&#x2F;keras-video-classification&#39;)</span><br><span class="line">print(os.getcwd())</span><br><span class="line">!ls</span><br><span class="line">!apt-get install p7zip</span><br><span class="line">!7z x sports-type-classifier-data.7z</span><br><span class="line">!ls</span><br><span class="line">!tree --dirsfirst --filelimit 50</span><br></pre></td></tr></table></figure>
<h3 id="开始"><a href="#开始" class="headerlink" title="开始"></a>开始</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br></pre></td><td class="code"><pre><span class="line"># USAGE</span><br><span class="line"># python train.py --dataset Sports-Type-Classifier&#x2F;data --model model&#x2F;activity.model --label-bin model&#x2F;lb.pickle --epochs 50</span><br><span class="line"></span><br><span class="line"># set the matplotlib backend so figures can be saved in the background</span><br><span class="line">import matplotlib</span><br><span class="line">matplotlib.use(&quot;Agg&quot;)</span><br><span class="line"></span><br><span class="line"># import the necessary packages</span><br><span class="line">from keras.preprocessing.image import ImageDataGenerator</span><br><span class="line">from keras.layers.pooling import AveragePooling2D</span><br><span class="line">from keras.applications import ResNet50</span><br><span class="line">from keras.layers.core import Dropout</span><br><span class="line">from keras.layers.core import Flatten</span><br><span class="line">from keras.layers.core import Dense</span><br><span class="line">from keras.layers import Input</span><br><span class="line">from keras.models import Model</span><br><span class="line">from keras.optimizers import SGD</span><br><span class="line">from sklearn.preprocessing import LabelBinarizer</span><br><span class="line">from sklearn.model_selection import train_test_split</span><br><span class="line">from sklearn.metrics import classification_report</span><br><span class="line">from imutils import paths</span><br><span class="line">import matplotlib.pyplot as plt</span><br><span class="line">import numpy as np</span><br><span class="line">import argparse</span><br><span class="line">import pickle</span><br><span class="line">import cv2</span><br><span class="line">import os</span><br><span class="line"></span><br><span class="line"># construct the argument parser and parse the arguments</span><br><span class="line"># 构建python文件运行时的命令行输入</span><br><span class="line">ap &#x3D; argparse.ArgumentParser()</span><br><span class="line">ap.add_argument(&quot;-d&quot;, &quot;--dataset&quot;, required&#x3D;True,</span><br><span class="line">	help&#x3D;&quot;path to input dataset&quot;)</span><br><span class="line">ap.add_argument(&quot;-m&quot;, &quot;--model&quot;, required&#x3D;True,</span><br><span class="line">	help&#x3D;&quot;path to output serialized model&quot;)</span><br><span class="line">ap.add_argument(&quot;-l&quot;, &quot;--label-bin&quot;, required&#x3D;True,</span><br><span class="line">	help&#x3D;&quot;path to output label binarizer&quot;)</span><br><span class="line">ap.add_argument(&quot;-e&quot;, &quot;--epochs&quot;, type&#x3D;int, default&#x3D;25,</span><br><span class="line">	help&#x3D;&quot;# of epochs to train our network for&quot;)</span><br><span class="line">ap.add_argument(&quot;-p&quot;, &quot;--plot&quot;, type&#x3D;str, default&#x3D;&quot;plot.png&quot;,</span><br><span class="line">	help&#x3D;&quot;path to output loss&#x2F;accuracy plot&quot;)</span><br><span class="line">args &#x3D; vars(ap.parse_args())</span><br><span class="line"></span><br><span class="line"># initialize the set of labels from the spots activity dataset we are</span><br><span class="line"># going to train our network on</span><br><span class="line">LABELS &#x3D; set([&quot;weight_lifting&quot;, &quot;tennis&quot;, &quot;football&quot;])</span><br><span class="line"></span><br><span class="line"># grab the list of images in our dataset directory, then initialize</span><br><span class="line"># the list of data (i.e., images) and class images</span><br><span class="line">print(&quot;[INFO] loading images...&quot;)</span><br><span class="line"># 通过imtuils的paths类获取dataset对应路径下所有图片的路径</span><br><span class="line">imagePaths &#x3D; list(paths.list_images(args[&quot;dataset&quot;])) </span><br><span class="line">data &#x3D; []</span><br><span class="line">labels &#x3D; []</span><br><span class="line"></span><br><span class="line"># loop over the image paths</span><br><span class="line">for imagePath in imagePaths:</span><br><span class="line">	# extract the class label from the filename</span><br><span class="line">	label &#x3D; imagePath.split(os.path.sep)[-2]</span><br><span class="line"></span><br><span class="line">	# if the label of the current image is not part of of the labels</span><br><span class="line">	# are interested in, then ignore the image</span><br><span class="line">	# 跳过不参与训练的标签对应的图片</span><br><span class="line">	if label not in LABELS:</span><br><span class="line">		continue</span><br><span class="line"></span><br><span class="line">	# load the image, convert it to RGB channel ordering, and resize</span><br><span class="line">	# it to be a fixed 224x224 pixels, ignoring aspect ratio</span><br><span class="line">	image &#x3D; cv2.imread(imagePath)</span><br><span class="line">	image &#x3D; cv2.cvtColor(image, cv2.COLOR_BGR2RGB)</span><br><span class="line">	image &#x3D; cv2.resize(image, (224, 224))</span><br><span class="line"></span><br><span class="line">	# update the data and labels lists, respectively</span><br><span class="line">	# 储存训练标签和图片</span><br><span class="line">	data.append(image)</span><br><span class="line">	labels.append(label)</span><br><span class="line"></span><br><span class="line"># convert the data and labels to NumPy arrays</span><br><span class="line"># 将数据和标签转换成numpy数组</span><br><span class="line">data &#x3D; np.array(data)</span><br><span class="line">labels &#x3D; np.array(labels)</span><br><span class="line"></span><br><span class="line"># perform one-hot encoding on the labels</span><br><span class="line"># 通过二值元素数组来对标签进行一键编码</span><br><span class="line">lb &#x3D; LabelBinarizer()</span><br><span class="line">labels &#x3D; lb.fit_transform(labels)</span><br><span class="line"></span><br><span class="line"># partition the data into training and testing splits using 75% of</span><br><span class="line"># the data for training and the remaining 25% for testing</span><br><span class="line"># 将整个数据的%75用来训练剩下的用来检验</span><br><span class="line">(trainX, testX, trainY, testY) &#x3D; train_test_split(data, labels,</span><br><span class="line">	test_size&#x3D;0.25, stratify&#x3D;labels, random_state&#x3D;42)</span><br><span class="line"></span><br><span class="line"># initialize the training data augmentation object</span><br><span class="line"># 声明训练时的数据增强操作</span><br><span class="line">trainAug &#x3D; ImageDataGenerator(</span><br><span class="line">	rotation_range&#x3D;30,</span><br><span class="line">	zoom_range&#x3D;0.15,</span><br><span class="line">	width_shift_range&#x3D;0.2,</span><br><span class="line">	height_shift_range&#x3D;0.2,</span><br><span class="line">	shear_range&#x3D;0.15,</span><br><span class="line">	horizontal_flip&#x3D;True,</span><br><span class="line">	fill_mode&#x3D;&quot;nearest&quot;)</span><br><span class="line"></span><br><span class="line"># initialize the validation&#x2F;testing data augmentation object (which</span><br><span class="line"># we&#39;ll be adding mean subtraction to)</span><br><span class="line"># 测验时无数据增强操作</span><br><span class="line">valAug &#x3D; ImageDataGenerator()</span><br><span class="line"></span><br><span class="line"># define the ImageNet mean subtraction (in RGB order) and set the</span><br><span class="line"># the mean subtraction value for each of the data augmentation</span><br><span class="line"># objects</span><br><span class="line"># 设置训练和测试时用来归一化的图片每个通道的均值</span><br><span class="line">mean &#x3D; np.array([123.68, 116.779, 103.939], dtype&#x3D;&quot;float32&quot;)</span><br><span class="line">trainAug.mean &#x3D; mean</span><br><span class="line">valAug.mean &#x3D; mean</span><br><span class="line"></span><br><span class="line"># load the ResNet-50 network, ensuring the head FC layer sets are left</span><br><span class="line"># off</span><br><span class="line"># 通过keras.applications来获取预训练的resnet50模型</span><br><span class="line">baseModel &#x3D; ResNet50(weights&#x3D;&quot;imagenet&quot;, include_top&#x3D;False,</span><br><span class="line">	input_tensor&#x3D;Input(shape&#x3D;(224, 224, 3)))</span><br><span class="line"></span><br><span class="line"># construct the head of the model that will be placed on top of the</span><br><span class="line"># the base model</span><br><span class="line"># 定义basemodel前的全连接层</span><br><span class="line">headModel &#x3D; baseModel.output</span><br><span class="line">headModel &#x3D; AveragePooling2D(pool_size&#x3D;(7, 7))(headModel)</span><br><span class="line">headModel &#x3D; Flatten(name&#x3D;&quot;flatten&quot;)(headModel)</span><br><span class="line">headModel &#x3D; Dense(512, activation&#x3D;&quot;relu&quot;)(headModel)</span><br><span class="line">headModel &#x3D; Dropout(0.5)(headModel)</span><br><span class="line">headModel &#x3D; Dense(len(lb.classes_), activation&#x3D;&quot;softmax&quot;)(headModel)</span><br><span class="line"></span><br><span class="line"># place the head FC model on top of the base model (this will become</span><br><span class="line"># the actual model we will train)</span><br><span class="line"># 在basemodel前加上一个全连接层来微调</span><br><span class="line">model &#x3D; Model(inputs&#x3D;baseModel.input, outputs&#x3D;headModel)</span><br><span class="line"></span><br><span class="line"># loop over all layers in the base model and freeze them so they will</span><br><span class="line"># *not* be updated during the training process</span><br><span class="line"># 训练时将basemodel里的全部参数冻结</span><br><span class="line">for layer in baseModel.layers:</span><br><span class="line">	layer.trainable &#x3D; False</span><br><span class="line"></span><br><span class="line"># compile our model (this needs to be done after our setting our</span><br><span class="line"># layers to being non-trainable)</span><br><span class="line"># 定义初始学习率和优化方法来编译模型</span><br><span class="line">print(&quot;[INFO] compiling model...&quot;)</span><br><span class="line">opt &#x3D; SGD(lr&#x3D;1e-4, momentum&#x3D;0.9, decay&#x3D;1e-4 &#x2F; args[&quot;epochs&quot;])</span><br><span class="line">model.compile(loss&#x3D;&quot;categorical_crossentropy&quot;, optimizer&#x3D;opt,</span><br><span class="line">	metrics&#x3D;[&quot;accuracy&quot;])</span><br><span class="line"></span><br><span class="line"># train the head of the network for a few epochs (all other layers</span><br><span class="line"># are frozen) -- this will allow the new FC layers to start to become</span><br><span class="line"># initialized with actual &quot;learned&quot; values versus pure random</span><br><span class="line"># 使用fit_generator类来对逐批生成的数据进行训练</span><br><span class="line">print(&quot;[INFO] training head...&quot;)</span><br><span class="line">H &#x3D; model.fit_generator(</span><br><span class="line">	trainAug.flow(trainX, trainY, batch_size&#x3D;32),</span><br><span class="line">	steps_per_epoch&#x3D;len(trainX) &#x2F;&#x2F; 32,</span><br><span class="line">	validation_data&#x3D;valAug.flow(testX, testY),</span><br><span class="line">	validation_steps&#x3D;len(testX) &#x2F;&#x2F; 32,</span><br><span class="line">	epochs&#x3D;args[&quot;epochs&quot;])</span><br><span class="line"></span><br><span class="line"># evaluate the network</span><br><span class="line"># 使用sklearn的classification_report类查看预测效果</span><br><span class="line">print(&quot;[INFO] evaluating network...&quot;)</span><br><span class="line">predictions &#x3D; model.predict(testX, batch_size&#x3D;32)</span><br><span class="line">print(classification_report(testY.argmax(axis&#x3D;1), </span><br><span class="line">	predictions.argmax(axis&#x3D;1), target_names&#x3D;lb.classes_))</span><br><span class="line"></span><br><span class="line"># plot the training loss and accuracy</span><br><span class="line"># 打印训练loss和准确性等</span><br><span class="line">N &#x3D; args[&quot;epochs&quot;]</span><br><span class="line">plt.style.use(&quot;ggplot&quot;)</span><br><span class="line">plt.figure()</span><br><span class="line">plt.plot(np.arange(0, N), H.history[&quot;loss&quot;], label&#x3D;&quot;train_loss&quot;)</span><br><span class="line">plt.plot(np.arange(0, N), H.history[&quot;val_loss&quot;], label&#x3D;&quot;val_loss&quot;)</span><br><span class="line">plt.plot(np.arange(0, N), H.history[&quot;acc&quot;], label&#x3D;&quot;train_acc&quot;)</span><br><span class="line">plt.plot(np.arange(0, N), H.history[&quot;val_acc&quot;], label&#x3D;&quot;val_acc&quot;)</span><br><span class="line">plt.title(&quot;Training Loss and Accuracy on Dataset&quot;)</span><br><span class="line">plt.xlabel(&quot;Epoch #&quot;)</span><br><span class="line">plt.ylabel(&quot;Loss&#x2F;Accuracy&quot;)</span><br><span class="line">plt.legend(loc&#x3D;&quot;lower left&quot;) # 标签说明放在左下角</span><br><span class="line">plt.savefig(args[&quot;plot&quot;])</span><br><span class="line"></span><br><span class="line"># serialize the model to disk</span><br><span class="line"># 讲训练好的模型保存</span><br><span class="line">print(&quot;[INFO] serializing network...&quot;)</span><br><span class="line">model.save(args[&quot;model&quot;])</span><br><span class="line"></span><br><span class="line"># serialize the label binarizer to disk</span><br><span class="line"># 保存标签二值化器</span><br><span class="line">f &#x3D; open(args[&quot;label_bin&quot;], &quot;wb&quot;)</span><br><span class="line">f.write(pickle.dumps(lb))</span><br><span class="line">f.close()</span><br><span class="line">!python train.py --dataset data --model output&#x2F;activity.model \</span><br><span class="line">	--label-bin output&#x2F;lb.pickle --epochs 50</span><br><span class="line">Using TensorFlow backend.</span><br><span class="line">[INFO] loading images...</span><br><span class="line">libpng warning: iCCP: known incorrect sRGB profile</span><br><span class="line">libpng warning: iCCP: known incorrect sRGB profile</span><br><span class="line">libpng warning: iCCP: known incorrect sRGB profile</span><br><span class="line">libpng warning: iCCP: known incorrect sRGB profile</span><br><span class="line">libpng warning: iCCP: known incorrect sRGB profile</span><br><span class="line">WARNING:tensorflow:From &#x2F;usr&#x2F;local&#x2F;lib&#x2F;python3.6&#x2F;dist-packages&#x2F;keras&#x2F;backend&#x2F;tensorflow_backend.py:66: The name tf.get_default_graph is deprecated. Please use tf.compat.v1.get_default_graph instead.</span><br><span class="line"></span><br><span class="line">WARNING:tensorflow:From &#x2F;usr&#x2F;local&#x2F;lib&#x2F;python3.6&#x2F;dist-packages&#x2F;keras&#x2F;backend&#x2F;tensorflow_backend.py:541: The name tf.placeholder is deprecated. Please use tf.compat.v1.placeholder instead.</span><br><span class="line"></span><br><span class="line">WARNING:tensorflow:From &#x2F;usr&#x2F;local&#x2F;lib&#x2F;python3.6&#x2F;dist-packages&#x2F;keras&#x2F;backend&#x2F;tensorflow_backend.py:4479: The name tf.truncated_normal is deprecated. Please use tf.random.truncated_normal instead.</span><br><span class="line"></span><br><span class="line">WARNING:tensorflow:From &#x2F;usr&#x2F;local&#x2F;lib&#x2F;python3.6&#x2F;dist-packages&#x2F;keras&#x2F;backend&#x2F;tensorflow_backend.py:190: The name tf.get_default_session is deprecated. Please use tf.compat.v1.get_default_session instead.</span><br><span class="line"></span><br><span class="line">WARNING:tensorflow:From &#x2F;usr&#x2F;local&#x2F;lib&#x2F;python3.6&#x2F;dist-packages&#x2F;keras&#x2F;backend&#x2F;tensorflow_backend.py:197: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.</span><br><span class="line"></span><br><span class="line">WARNING:tensorflow:From &#x2F;usr&#x2F;local&#x2F;lib&#x2F;python3.6&#x2F;dist-packages&#x2F;keras&#x2F;backend&#x2F;tensorflow_backend.py:203: The name tf.Session is deprecated. Please use tf.compat.v1.Session instead.</span><br><span class="line"></span><br><span class="line">2019-12-14 08:24:02.011318: I tensorflow&#x2F;core&#x2F;platform&#x2F;profile_utils&#x2F;cpu_utils.cc:94] CPU Frequency: 2300000000 Hz</span><br><span class="line">2019-12-14 08:24:02.013846: I tensorflow&#x2F;compiler&#x2F;xla&#x2F;service&#x2F;service.cc:168] XLA service 0x2306840 initialized for platform Host (this does not guarantee that XLA will be used). Devices:</span><br><span class="line">2019-12-14 08:24:02.013885: I tensorflow&#x2F;compiler&#x2F;xla&#x2F;service&#x2F;service.cc:176]   StreamExecutor device (0): Host, Default Version</span><br><span class="line">2019-12-14 08:24:02.018815: I tensorflow&#x2F;stream_executor&#x2F;platform&#x2F;default&#x2F;dso_loader.cc:44] Successfully opened dynamic library libcuda.so.1</span><br><span class="line">2019-12-14 08:24:02.152830: I tensorflow&#x2F;stream_executor&#x2F;cuda&#x2F;cuda_gpu_executor.cc:983] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero</span><br><span class="line">2019-12-14 08:24:02.153830: I tensorflow&#x2F;compiler&#x2F;xla&#x2F;service&#x2F;service.cc:168] XLA service 0x2306bc0 initialized for platform CUDA (this does not guarantee that XLA will be used). Devices:</span><br><span class="line">2019-12-14 08:24:02.153865: I tensorflow&#x2F;compiler&#x2F;xla&#x2F;service&#x2F;service.cc:176]   StreamExecutor device (0): Tesla K80, Compute Capability 3.7</span><br><span class="line">2019-12-14 08:24:02.155504: I tensorflow&#x2F;stream_executor&#x2F;cuda&#x2F;cuda_gpu_executor.cc:983] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero</span><br><span class="line">2019-12-14 08:24:02.156205: I tensorflow&#x2F;core&#x2F;common_runtime&#x2F;gpu&#x2F;gpu_device.cc:1618] Found device 0 with properties: </span><br><span class="line">name: Tesla K80 major: 3 minor: 7 memoryClockRate(GHz): 0.8235</span><br><span class="line">pciBusID: 0000:00:04.0</span><br><span class="line">2019-12-14 08:24:02.176292: I tensorflow&#x2F;stream_executor&#x2F;platform&#x2F;default&#x2F;dso_loader.cc:44] Successfully opened dynamic library libcudart.so.10.1</span><br><span class="line">2019-12-14 08:24:02.394209: I tensorflow&#x2F;stream_executor&#x2F;platform&#x2F;default&#x2F;dso_loader.cc:44] Successfully opened dynamic library libcublas.so.10</span><br><span class="line">2019-12-14 08:24:02.508460: I tensorflow&#x2F;stream_executor&#x2F;platform&#x2F;default&#x2F;dso_loader.cc:44] Successfully opened dynamic library libcufft.so.10</span><br><span class="line">2019-12-14 08:24:02.530840: I tensorflow&#x2F;stream_executor&#x2F;platform&#x2F;default&#x2F;dso_loader.cc:44] Successfully opened dynamic library libcurand.so.10</span><br><span class="line">2019-12-14 08:24:02.748284: I tensorflow&#x2F;stream_executor&#x2F;platform&#x2F;default&#x2F;dso_loader.cc:44] Successfully opened dynamic library libcusolver.so.10</span><br><span class="line">2019-12-14 08:24:02.770949: I tensorflow&#x2F;stream_executor&#x2F;platform&#x2F;default&#x2F;dso_loader.cc:44] Successfully opened dynamic library libcusparse.so.10</span><br><span class="line">2019-12-14 08:24:03.213586: I tensorflow&#x2F;stream_executor&#x2F;platform&#x2F;default&#x2F;dso_loader.cc:44] Successfully opened dynamic library libcudnn.so.7</span><br><span class="line">2019-12-14 08:24:03.213829: I tensorflow&#x2F;stream_executor&#x2F;cuda&#x2F;cuda_gpu_executor.cc:983] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero</span><br><span class="line">2019-12-14 08:24:03.214779: I tensorflow&#x2F;stream_executor&#x2F;cuda&#x2F;cuda_gpu_executor.cc:983] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero</span><br><span class="line">2019-12-14 08:24:03.215576: I tensorflow&#x2F;core&#x2F;common_runtime&#x2F;gpu&#x2F;gpu_device.cc:1746] Adding visible gpu devices: 0</span><br><span class="line">2019-12-14 08:24:03.220635: I tensorflow&#x2F;stream_executor&#x2F;platform&#x2F;default&#x2F;dso_loader.cc:44] Successfully opened dynamic library libcudart.so.10.1</span><br><span class="line">2019-12-14 08:24:03.222331: I tensorflow&#x2F;core&#x2F;common_runtime&#x2F;gpu&#x2F;gpu_device.cc:1159] Device interconnect StreamExecutor with strength 1 edge matrix:</span><br><span class="line">2019-12-14 08:24:03.222385: I tensorflow&#x2F;core&#x2F;common_runtime&#x2F;gpu&#x2F;gpu_device.cc:1165]      0 </span><br><span class="line">2019-12-14 08:24:03.222418: I tensorflow&#x2F;core&#x2F;common_runtime&#x2F;gpu&#x2F;gpu_device.cc:1178] 0:   N </span><br><span class="line">2019-12-14 08:24:03.223491: I tensorflow&#x2F;stream_executor&#x2F;cuda&#x2F;cuda_gpu_executor.cc:983] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero</span><br><span class="line">2019-12-14 08:24:03.224341: I tensorflow&#x2F;stream_executor&#x2F;cuda&#x2F;cuda_gpu_executor.cc:983] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero</span><br><span class="line">2019-12-14 08:24:03.225215: W tensorflow&#x2F;core&#x2F;common_runtime&#x2F;gpu&#x2F;gpu_bfc_allocator.cc:39] Overriding allow_growth setting because the TF_FORCE_GPU_ALLOW_GROWTH environment variable is set. Original config value was 0.</span><br><span class="line">2019-12-14 08:24:03.225289: I tensorflow&#x2F;core&#x2F;common_runtime&#x2F;gpu&#x2F;gpu_device.cc:1304] Created TensorFlow device (&#x2F;job:localhost&#x2F;replica:0&#x2F;task:0&#x2F;device:GPU:0 with 10805 MB memory) -&gt; physical GPU (device: 0, name: Tesla K80, pci bus id: 0000:00:04.0, compute capability: 3.7)</span><br><span class="line">WARNING:tensorflow:From &#x2F;usr&#x2F;local&#x2F;lib&#x2F;python3.6&#x2F;dist-packages&#x2F;keras&#x2F;backend&#x2F;tensorflow_backend.py:207: The name tf.global_variables is deprecated. Please use tf.compat.v1.global_variables instead.</span><br><span class="line"></span><br><span class="line">WARNING:tensorflow:From &#x2F;usr&#x2F;local&#x2F;lib&#x2F;python3.6&#x2F;dist-packages&#x2F;keras&#x2F;backend&#x2F;tensorflow_backend.py:216: The name tf.is_variable_initialized is deprecated. Please use tf.compat.v1.is_variable_initialized instead.</span><br><span class="line"></span><br><span class="line">WARNING:tensorflow:From &#x2F;usr&#x2F;local&#x2F;lib&#x2F;python3.6&#x2F;dist-packages&#x2F;keras&#x2F;backend&#x2F;tensorflow_backend.py:223: The name tf.variables_initializer is deprecated. Please use tf.compat.v1.variables_initializer instead.</span><br><span class="line"></span><br><span class="line">WARNING:tensorflow:From &#x2F;usr&#x2F;local&#x2F;lib&#x2F;python3.6&#x2F;dist-packages&#x2F;keras&#x2F;backend&#x2F;tensorflow_backend.py:2041: The name tf.nn.fused_batch_norm is deprecated. Please use tf.compat.v1.nn.fused_batch_norm instead.</span><br><span class="line"></span><br><span class="line">WARNING:tensorflow:From &#x2F;usr&#x2F;local&#x2F;lib&#x2F;python3.6&#x2F;dist-packages&#x2F;keras&#x2F;backend&#x2F;tensorflow_backend.py:148: The name tf.placeholder_with_default is deprecated. Please use tf.compat.v1.placeholder_with_default instead.</span><br><span class="line"></span><br><span class="line">WARNING:tensorflow:From &#x2F;usr&#x2F;local&#x2F;lib&#x2F;python3.6&#x2F;dist-packages&#x2F;keras&#x2F;backend&#x2F;tensorflow_backend.py:4267: The name tf.nn.max_pool is deprecated. Please use tf.nn.max_pool2d instead.</span><br><span class="line"></span><br><span class="line">&#x2F;usr&#x2F;local&#x2F;lib&#x2F;python3.6&#x2F;dist-packages&#x2F;keras_applications&#x2F;resnet50.py:265: UserWarning: The output shape of &#96;ResNet50(include_top&#x3D;False)&#96; has been changed since Keras 2.2.0.</span><br><span class="line">  warnings.warn(&#39;The output shape of &#96;ResNet50(include_top&#x3D;False)&#96; &#39;</span><br><span class="line">Downloading data from https:&#x2F;&#x2F;github.com&#x2F;fchollet&#x2F;deep-learning-models&#x2F;releases&#x2F;download&#x2F;v0.2&#x2F;resnet50_weights_tf_dim_ordering_tf_kernels_notop.h5</span><br><span class="line">94658560&#x2F;94653016 [&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;] - 7s 0us&#x2F;step</span><br><span class="line">WARNING:tensorflow:From &#x2F;usr&#x2F;local&#x2F;lib&#x2F;python3.6&#x2F;dist-packages&#x2F;keras&#x2F;backend&#x2F;tensorflow_backend.py:4271: The name tf.nn.avg_pool is deprecated. Please use tf.nn.avg_pool2d instead.</span><br><span class="line"></span><br><span class="line">WARNING:tensorflow:From &#x2F;usr&#x2F;local&#x2F;lib&#x2F;python3.6&#x2F;dist-packages&#x2F;keras&#x2F;backend&#x2F;tensorflow_backend.py:4432: The name tf.random_uniform is deprecated. Please use tf.random.uniform instead.</span><br><span class="line"></span><br><span class="line">WARNING:tensorflow:From &#x2F;usr&#x2F;local&#x2F;lib&#x2F;python3.6&#x2F;dist-packages&#x2F;keras&#x2F;backend&#x2F;tensorflow_backend.py:3733: calling dropout (from tensorflow.python.ops.nn_ops) with keep_prob is deprecated and will be removed in a future version.</span><br><span class="line">Instructions for updating:</span><br><span class="line">Please use &#96;rate&#96; instead of &#96;keep_prob&#96;. Rate should be set to &#96;rate &#x3D; 1 - keep_prob&#96;.</span><br><span class="line">[INFO] compiling model...</span><br><span class="line">WARNING:tensorflow:From &#x2F;usr&#x2F;local&#x2F;lib&#x2F;python3.6&#x2F;dist-packages&#x2F;keras&#x2F;optimizers.py:793: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.</span><br><span class="line"></span><br><span class="line">WARNING:tensorflow:From &#x2F;usr&#x2F;local&#x2F;lib&#x2F;python3.6&#x2F;dist-packages&#x2F;keras&#x2F;backend&#x2F;tensorflow_backend.py:3576: The name tf.log is deprecated. Please use tf.math.log instead.</span><br><span class="line"></span><br><span class="line">[INFO] training head...</span><br><span class="line">WARNING:tensorflow:From &#x2F;usr&#x2F;local&#x2F;lib&#x2F;python3.6&#x2F;dist-packages&#x2F;tensorflow_core&#x2F;python&#x2F;ops&#x2F;math_grad.py:1424: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.</span><br><span class="line">Instructions for updating:</span><br><span class="line">Use tf.where in 2.0, which has the same broadcast rule as np.where</span><br><span class="line">WARNING:tensorflow:From &#x2F;usr&#x2F;local&#x2F;lib&#x2F;python3.6&#x2F;dist-packages&#x2F;keras&#x2F;backend&#x2F;tensorflow_backend.py:1033: The name tf.assign_add is deprecated. Please use tf.compat.v1.assign_add instead.</span><br><span class="line"></span><br><span class="line">WARNING:tensorflow:From &#x2F;usr&#x2F;local&#x2F;lib&#x2F;python3.6&#x2F;dist-packages&#x2F;keras&#x2F;backend&#x2F;tensorflow_backend.py:1020: The name tf.assign is deprecated. Please use tf.compat.v1.assign instead.</span><br><span class="line"></span><br><span class="line">Epoch 1&#x2F;50</span><br><span class="line">2019-12-14 08:24:25.840365: I tensorflow&#x2F;stream_executor&#x2F;platform&#x2F;default&#x2F;dso_loader.cc:44] Successfully opened dynamic library libcublas.so.10</span><br><span class="line">2019-12-14 08:24:26.891772: I tensorflow&#x2F;stream_executor&#x2F;platform&#x2F;default&#x2F;dso_loader.cc:44] Successfully opened dynamic library libcudnn.so.7</span><br><span class="line">48&#x2F;48 [&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;] - 29s 597ms&#x2F;step - loss: 1.2660 - acc: 0.3822 - val_loss: 0.9862 - val_acc: 0.5332</span><br><span class="line">Epoch 2&#x2F;50</span><br><span class="line">48&#x2F;48 [&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;] - 24s 504ms&#x2F;step - loss: 1.0399 - acc: 0.4962 - val_loss: 0.8028 - val_acc: 0.6337</span><br><span class="line">Epoch 3&#x2F;50</span><br><span class="line">48&#x2F;48 [&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;] - 24s 496ms&#x2F;step - loss: 0.8882 - acc: 0.5950 - val_loss: 0.6543 - val_acc: 0.7119</span><br><span class="line">Epoch 4&#x2F;50</span><br><span class="line">48&#x2F;48 [&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;] - 23s 478ms&#x2F;step - loss: 0.8053 - acc: 0.6517 - val_loss: 0.5938 - val_acc: 0.7510</span><br><span class="line">Epoch 5&#x2F;50</span><br><span class="line">48&#x2F;48 [&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;] - 23s 479ms&#x2F;step - loss: 0.7165 - acc: 0.6940 - val_loss: 0.4964 - val_acc: 0.8045</span><br><span class="line">Epoch 6&#x2F;50</span><br><span class="line">48&#x2F;48 [&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;] - 24s 490ms&#x2F;step - loss: 0.6342 - acc: 0.7500 - val_loss: 0.4970 - val_acc: 0.8148</span><br><span class="line">Epoch 7&#x2F;50</span><br><span class="line">48&#x2F;48 [&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;] - 23s 471ms&#x2F;step - loss: 0.6217 - acc: 0.7526 - val_loss: 0.4313 - val_acc: 0.8313</span><br><span class="line">Epoch 8&#x2F;50</span><br><span class="line">48&#x2F;48 [&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;] - 22s 464ms&#x2F;step - loss: 0.5881 - acc: 0.7832 - val_loss: 0.3984 - val_acc: 0.8683</span><br><span class="line">Epoch 9&#x2F;50</span><br><span class="line">48&#x2F;48 [&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;] - 23s 475ms&#x2F;step - loss: 0.5611 - acc: 0.7741 - val_loss: 0.4083 - val_acc: 0.8498</span><br><span class="line">Epoch 10&#x2F;50</span><br><span class="line">48&#x2F;48 [&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;] - 23s 471ms&#x2F;step - loss: 0.5241 - acc: 0.8073 - val_loss: 0.3564 - val_acc: 0.8807</span><br><span class="line">Epoch 11&#x2F;50</span><br><span class="line">48&#x2F;48 [&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;] - 22s 459ms&#x2F;step - loss: 0.4947 - acc: 0.8171 - val_loss: 0.3755 - val_acc: 0.8642</span><br><span class="line">Epoch 12&#x2F;50</span><br><span class="line">48&#x2F;48 [&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;] - 22s 467ms&#x2F;step - loss: 0.4841 - acc: 0.8190 - val_loss: 0.3499 - val_acc: 0.8704</span><br><span class="line">Epoch 13&#x2F;50</span><br><span class="line">48&#x2F;48 [&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;] - 22s 463ms&#x2F;step - loss: 0.4801 - acc: 0.8196 - val_loss: 0.3397 - val_acc: 0.8704</span><br><span class="line">Epoch 14&#x2F;50</span><br><span class="line">48&#x2F;48 [&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;] - 22s 455ms&#x2F;step - loss: 0.4430 - acc: 0.8242 - val_loss: 0.3491 - val_acc: 0.8786</span><br><span class="line">Epoch 15&#x2F;50</span><br><span class="line">48&#x2F;48 [&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;] - 22s 456ms&#x2F;step - loss: 0.4179 - acc: 0.8477 - val_loss: 0.2985 - val_acc: 0.8909</span><br><span class="line">Epoch 16&#x2F;50</span><br><span class="line">48&#x2F;48 [&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;] - 22s 448ms&#x2F;step - loss: 0.4189 - acc: 0.8379 - val_loss: 0.3302 - val_acc: 0.8807</span><br><span class="line">Epoch 17&#x2F;50</span><br><span class="line">48&#x2F;48 [&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;] - 22s 454ms&#x2F;step - loss: 0.4167 - acc: 0.8425 - val_loss: 0.3139 - val_acc: 0.8868</span><br><span class="line">Epoch 18&#x2F;50</span><br><span class="line">48&#x2F;48 [&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;] - 22s 464ms&#x2F;step - loss: 0.3985 - acc: 0.8444 - val_loss: 0.3067 - val_acc: 0.8926</span><br><span class="line">Epoch 19&#x2F;50</span><br><span class="line">48&#x2F;48 [&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;] - 21s 447ms&#x2F;step - loss: 0.3881 - acc: 0.8587 - val_loss: 0.3024 - val_acc: 0.8951</span><br><span class="line">Epoch 20&#x2F;50</span><br><span class="line">48&#x2F;48 [&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;] - 22s 459ms&#x2F;step - loss: 0.3944 - acc: 0.8548 - val_loss: 0.2902 - val_acc: 0.8992</span><br><span class="line">Epoch 21&#x2F;50</span><br><span class="line">48&#x2F;48 [&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;] - 21s 446ms&#x2F;step - loss: 0.3782 - acc: 0.8620 - val_loss: 0.2824 - val_acc: 0.9115</span><br><span class="line">Epoch 22&#x2F;50</span><br><span class="line">48&#x2F;48 [&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;] - 21s 440ms&#x2F;step - loss: 0.4034 - acc: 0.8412 - val_loss: 0.3105 - val_acc: 0.9012</span><br><span class="line">Epoch 23&#x2F;50</span><br><span class="line">48&#x2F;48 [&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;] - 22s 461ms&#x2F;step - loss: 0.3600 - acc: 0.8691 - val_loss: 0.2667 - val_acc: 0.9012</span><br><span class="line">Epoch 24&#x2F;50</span><br><span class="line">48&#x2F;48 [&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;] - 22s 456ms&#x2F;step - loss: 0.3357 - acc: 0.8750 - val_loss: 0.2630 - val_acc: 0.9177</span><br><span class="line">Epoch 25&#x2F;50</span><br><span class="line">48&#x2F;48 [&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;] - 21s 440ms&#x2F;step - loss: 0.3411 - acc: 0.8737 - val_loss: 0.3130 - val_acc: 0.8951</span><br><span class="line">Epoch 26&#x2F;50</span><br><span class="line">48&#x2F;48 [&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;] - 22s 460ms&#x2F;step - loss: 0.3312 - acc: 0.8848 - val_loss: 0.2747 - val_acc: 0.9198</span><br><span class="line">Epoch 27&#x2F;50</span><br><span class="line">48&#x2F;48 [&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;] - 22s 448ms&#x2F;step - loss: 0.3401 - acc: 0.8691 - val_loss: 0.2811 - val_acc: 0.9033</span><br><span class="line">Epoch 28&#x2F;50</span><br><span class="line">48&#x2F;48 [&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;] - 21s 445ms&#x2F;step - loss: 0.3326 - acc: 0.8776 - val_loss: 0.2546 - val_acc: 0.9280</span><br><span class="line">Epoch 29&#x2F;50</span><br><span class="line">48&#x2F;48 [&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;] - 21s 442ms&#x2F;step - loss: 0.3445 - acc: 0.8692 - val_loss: 0.2683 - val_acc: 0.9156</span><br><span class="line">Epoch 30&#x2F;50</span><br><span class="line">48&#x2F;48 [&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;] - 22s 454ms&#x2F;step - loss: 0.3072 - acc: 0.8854 - val_loss: 0.2658 - val_acc: 0.9095</span><br><span class="line">Epoch 31&#x2F;50</span><br><span class="line">48&#x2F;48 [&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;] - 22s 449ms&#x2F;step - loss: 0.3029 - acc: 0.8978 - val_loss: 0.2819 - val_acc: 0.9033</span><br><span class="line">Epoch 32&#x2F;50</span><br><span class="line">48&#x2F;48 [&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;] - 22s 457ms&#x2F;step - loss: 0.3123 - acc: 0.8900 - val_loss: 0.2680 - val_acc: 0.9198</span><br><span class="line">Epoch 33&#x2F;50</span><br><span class="line">48&#x2F;48 [&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;] - 22s 450ms&#x2F;step - loss: 0.3020 - acc: 0.8867 - val_loss: 0.2422 - val_acc: 0.9198</span><br><span class="line">Epoch 34&#x2F;50</span><br><span class="line">48&#x2F;48 [&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;] - 22s 463ms&#x2F;step - loss: 0.3244 - acc: 0.8802 - val_loss: 0.2712 - val_acc: 0.9115</span><br><span class="line">Epoch 35&#x2F;50</span><br><span class="line">48&#x2F;48 [&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;] - 22s 462ms&#x2F;step - loss: 0.2898 - acc: 0.8952 - val_loss: 0.2588 - val_acc: 0.9160</span><br><span class="line">Epoch 36&#x2F;50</span><br><span class="line">48&#x2F;48 [&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;] - 22s 454ms&#x2F;step - loss: 0.3157 - acc: 0.8854 - val_loss: 0.2807 - val_acc: 0.9095</span><br><span class="line">Epoch 37&#x2F;50</span><br><span class="line">48&#x2F;48 [&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;] - 22s 465ms&#x2F;step - loss: 0.3021 - acc: 0.8848 - val_loss: 0.2514 - val_acc: 0.9218</span><br><span class="line">Epoch 38&#x2F;50</span><br><span class="line">48&#x2F;48 [&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;] - 22s 453ms&#x2F;step - loss: 0.3053 - acc: 0.8731 - val_loss: 0.2646 - val_acc: 0.9053</span><br><span class="line">Epoch 39&#x2F;50</span><br><span class="line">48&#x2F;48 [&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;] - 22s 454ms&#x2F;step - loss: 0.2845 - acc: 0.8874 - val_loss: 0.2502 - val_acc: 0.9177</span><br><span class="line">Epoch 40&#x2F;50</span><br><span class="line">48&#x2F;48 [&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;] - 21s 443ms&#x2F;step - loss: 0.2850 - acc: 0.8972 - val_loss: 0.2571 - val_acc: 0.9136</span><br><span class="line">Epoch 41&#x2F;50</span><br><span class="line">48&#x2F;48 [&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;] - 22s 461ms&#x2F;step - loss: 0.2892 - acc: 0.8997 - val_loss: 0.2667 - val_acc: 0.9156</span><br><span class="line">Epoch 42&#x2F;50</span><br><span class="line">48&#x2F;48 [&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;] - 22s 450ms&#x2F;step - loss: 0.2804 - acc: 0.8971 - val_loss: 0.2466 - val_acc: 0.9115</span><br><span class="line">Epoch 43&#x2F;50</span><br><span class="line">48&#x2F;48 [&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;] - 21s 436ms&#x2F;step - loss: 0.2756 - acc: 0.8978 - val_loss: 0.2548 - val_acc: 0.9177</span><br><span class="line">Epoch 44&#x2F;50</span><br><span class="line">48&#x2F;48 [&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;] - 21s 445ms&#x2F;step - loss: 0.2730 - acc: 0.9010 - val_loss: 0.2562 - val_acc: 0.9239</span><br><span class="line">Epoch 45&#x2F;50</span><br><span class="line">48&#x2F;48 [&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;] - 21s 443ms&#x2F;step - loss: 0.2724 - acc: 0.9017 - val_loss: 0.2561 - val_acc: 0.9259</span><br><span class="line">Epoch 46&#x2F;50</span><br><span class="line">48&#x2F;48 [&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;] - 22s 455ms&#x2F;step - loss: 0.2871 - acc: 0.8906 - val_loss: 0.2700 - val_acc: 0.9239</span><br><span class="line">Epoch 47&#x2F;50</span><br><span class="line">48&#x2F;48 [&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;] - 22s 456ms&#x2F;step - loss: 0.2734 - acc: 0.9017 - val_loss: 0.2244 - val_acc: 0.9259</span><br><span class="line">Epoch 48&#x2F;50</span><br><span class="line">48&#x2F;48 [&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;] - 22s 453ms&#x2F;step - loss: 0.2570 - acc: 0.9062 - val_loss: 0.2566 - val_acc: 0.9156</span><br><span class="line">Epoch 49&#x2F;50</span><br><span class="line">48&#x2F;48 [&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;] - 22s 450ms&#x2F;step - loss: 0.2457 - acc: 0.9069 - val_loss: 0.2649 - val_acc: 0.9177</span><br><span class="line">Epoch 50&#x2F;50</span><br><span class="line">48&#x2F;48 [&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;] - 21s 446ms&#x2F;step - loss: 0.2753 - acc: 0.8997 - val_loss: 0.2346 - val_acc: 0.9300</span><br><span class="line">[INFO] evaluating network...</span><br><span class="line">                precision    recall  f1-score   support</span><br><span class="line"></span><br><span class="line">      football       0.92      0.95      0.93       196</span><br><span class="line">        tennis       0.92      0.91      0.92       179</span><br><span class="line">weight_lifting       0.94      0.91      0.92       143</span><br><span class="line"></span><br><span class="line">      accuracy                           0.92       518</span><br><span class="line">     macro avg       0.93      0.92      0.92       518</span><br><span class="line">  weighted avg       0.92      0.92      0.92       518</span><br><span class="line"></span><br><span class="line">[INFO] serializing network...</span><br></pre></td></tr></table></figure>
<h3 id="用滚动预测平均的方式应用模型到视频分类中"><a href="#用滚动预测平均的方式应用模型到视频分类中" class="headerlink" title="用滚动预测平均的方式应用模型到视频分类中"></a>用滚动预测平均的方式应用模型到视频分类中</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br></pre></td><td class="code"><pre><span class="line"># USAGE</span><br><span class="line"># python predict_video.py --model model&#x2F;activity.model --label-bin model&#x2F;lb.pickle --input example_clips&#x2F;lifting.mp4 --output output&#x2F;lifting_128avg.avi --size 128</span><br><span class="line"></span><br><span class="line"># import the necessary packages</span><br><span class="line">from keras.models import load_model</span><br><span class="line">from collections import deque #用来实现滑动平均</span><br><span class="line">import numpy as np</span><br><span class="line">import argparse</span><br><span class="line">import pickle</span><br><span class="line">import cv2</span><br><span class="line">from matplotlib import pyplot as plt</span><br><span class="line"></span><br><span class="line"># construct the argument parser and parse the arguments</span><br><span class="line">ap &#x3D; argparse.ArgumentParser()</span><br><span class="line">ap.add_argument(&quot;-m&quot;, &quot;--model&quot;, required&#x3D;True,</span><br><span class="line">	help&#x3D;&quot;path to trained serialized model&quot;)</span><br><span class="line">ap.add_argument(&quot;-l&quot;, &quot;--label-bin&quot;, required&#x3D;True,</span><br><span class="line">	help&#x3D;&quot;path to  label binarizer&quot;)</span><br><span class="line">ap.add_argument(&quot;-i&quot;, &quot;--input&quot;, required&#x3D;True,</span><br><span class="line">	help&#x3D;&quot;path to our input video&quot;)</span><br><span class="line">ap.add_argument(&quot;-o&quot;, &quot;--output&quot;, required&#x3D;True,</span><br><span class="line">	help&#x3D;&quot;path to our output video&quot;)</span><br><span class="line">ap.add_argument(&quot;-s&quot;, &quot;--size&quot;, type&#x3D;int, default&#x3D;128,</span><br><span class="line">	help&#x3D;&quot;size of queue for averaging&quot;)</span><br><span class="line">args &#x3D; vars(ap.parse_args())</span><br><span class="line"></span><br><span class="line"># load the trained model and label binarizer from disk</span><br><span class="line"># 从命令行的声明载入训练好的模型以及二值化</span><br><span class="line">print(&quot;[INFO] loading model and label binarizer...&quot;)</span><br><span class="line">model &#x3D; load_model(args[&quot;model&quot;])</span><br><span class="line">lb &#x3D; pickle.loads(open(args[&quot;label_bin&quot;], &quot;rb&quot;).read())</span><br><span class="line"></span><br><span class="line"># initialize the image mean for mean subtraction along with the</span><br><span class="line"># predictions queue</span><br><span class="line">mean &#x3D; np.array([123.68, 116.779, 103.939][::1], dtype&#x3D;&quot;float32&quot;)</span><br><span class="line"># 初始化Q为一个双向序列，deque的尺寸由size决定</span><br><span class="line">Q &#x3D; deque(maxlen&#x3D;args[&quot;size&quot;])</span><br><span class="line"></span><br><span class="line"># initialize the video stream, pointer to output video file, and</span><br><span class="line"># frame dimensions</span><br><span class="line"># 使用opencv的VideoCapture类读取视频流，并初始化视频写入类</span><br><span class="line">vs &#x3D; cv2.VideoCapture(args[&quot;input&quot;])</span><br><span class="line">writer &#x3D; None</span><br><span class="line">(W, H) &#x3D; (None, None)</span><br><span class="line"></span><br><span class="line"># loop over frames from the video file stream</span><br><span class="line"># 循环抓取被测试视频的帧</span><br><span class="line">while True:</span><br><span class="line">	# read the next frame from the file</span><br><span class="line">	(grabbed, frame) &#x3D; vs.read()</span><br><span class="line"></span><br><span class="line">	# if the frame was not grabbed, then we have reached the end</span><br><span class="line">	# of the stream</span><br><span class="line">	# 如果没有抓取到视频帧，则退出</span><br><span class="line">	if not grabbed:</span><br><span class="line">		break</span><br><span class="line"></span><br><span class="line">	# if the frame dimensions are empty, grab them</span><br><span class="line">	if W is None or H is None:</span><br><span class="line">		(H, W) &#x3D; frame.shape[:2]</span><br><span class="line"></span><br><span class="line">	# clone the output frame, then convert it from BGR to RGB</span><br><span class="line">	# ordering, resize the frame to a fixed 224x224, and then</span><br><span class="line">	# perform mean subtraction 归一化操作</span><br><span class="line">	output &#x3D; frame.copy()</span><br><span class="line">	frame &#x3D; cv2.cvtColor(frame, cv2.COLOR_BGR2RGB)</span><br><span class="line">	frame &#x3D; cv2.resize(frame, (224, 224)).astype(&quot;float32&quot;) #改变图像宽和高，像素转移到特定数据类型</span><br><span class="line">	frame -&#x3D; mean</span><br><span class="line"></span><br><span class="line">	# make predictions on the frame and then update the predictions</span><br><span class="line">	# queue</span><br><span class="line">	# 新建一维用来储存每一帧对应的分类结果</span><br><span class="line">	preds &#x3D; model.predict(np.expand_dims(frame, axis&#x3D;0))[0]</span><br><span class="line">	# 将预测值加载Q后面</span><br><span class="line">	Q.append(preds)</span><br><span class="line"></span><br><span class="line">	# perform prediction averaging over the current history of</span><br><span class="line">	# previous predictions</span><br><span class="line">	# 先平均到K个概率输出值，在取最大</span><br><span class="line">	results &#x3D; np.array(Q).mean(axis&#x3D;0)</span><br><span class="line">	i &#x3D; np.argmax(results)</span><br><span class="line">	label &#x3D; lb.classes_[i]</span><br><span class="line"></span><br><span class="line">	# draw the activity on the output frame</span><br><span class="line">	text &#x3D; &quot;activity: &#123;&#125;&quot;.format(label)</span><br><span class="line">	cv2.putText(output, text, (35, 50), cv2.FONT_HERSHEY_SIMPLEX,</span><br><span class="line">		1.25, (0, 255, 0), 5)</span><br><span class="line"></span><br><span class="line">	# check if the video writer is None</span><br><span class="line">	if writer is None:</span><br><span class="line">		# initialize our video writer</span><br><span class="line">		fourcc &#x3D; cv2.VideoWriter_fourcc(*&quot;MJPG&quot;)</span><br><span class="line">		writer &#x3D; cv2.VideoWriter(args[&quot;output&quot;], fourcc, 30,</span><br><span class="line">			(W, H), True)</span><br><span class="line"></span><br><span class="line">	# write the output frame to disk</span><br><span class="line">	writer.write(output)</span><br><span class="line"></span><br><span class="line">	# show the output image</span><br><span class="line">	# 避免cannot connect to X server，此处使用matplotlib</span><br><span class="line">	# cv2.imshow(&quot;Output&quot;, output)</span><br><span class="line">  plt.imshow(output)</span><br><span class="line">	key &#x3D; cv2.waitKey(1) &amp; 0xFF</span><br><span class="line"></span><br><span class="line">	# if the &#96;q&#96; key was pressed, break from the loop</span><br><span class="line">	if key &#x3D;&#x3D; ord(&quot;q&quot;):</span><br><span class="line">		break</span><br><span class="line"></span><br><span class="line"># release the file pointers</span><br><span class="line">print(&quot;[INFO] cleaning up...&quot;)</span><br><span class="line">writer.release()</span><br><span class="line">vs.release()</span><br><span class="line">!sudo apt-get install tree</span><br><span class="line">!tree --dirsfirst --filelimit 50</span><br><span class="line">.</span><br><span class="line">├── data</span><br><span class="line">│   ├── badminton [938 entries exceeds filelimit, not opening dir]</span><br><span class="line">│   ├── baseball [746 entries exceeds filelimit, not opening dir]</span><br><span class="line">│   ├── basketball [495 entries exceeds filelimit, not opening dir]</span><br><span class="line">│   ├── boxing [705 entries exceeds filelimit, not opening dir]</span><br><span class="line">│   ├── chess [481 entries exceeds filelimit, not opening dir]</span><br><span class="line">│   ├── cricket [715 entries exceeds filelimit, not opening dir]</span><br><span class="line">│   ├── fencing [635 entries exceeds filelimit, not opening dir]</span><br><span class="line">│   ├── football [799 entries exceeds filelimit, not opening dir]</span><br><span class="line">│   ├── formula1 [687 entries exceeds filelimit, not opening dir]</span><br><span class="line">│   ├── gymnastics [719 entries exceeds filelimit, not opening dir]</span><br><span class="line">│   ├── hockey [572 entries exceeds filelimit, not opening dir]</span><br><span class="line">│   ├── ice_hockey [715 entries exceeds filelimit, not opening dir]</span><br><span class="line">│   ├── kabaddi [454 entries exceeds filelimit, not opening dir]</span><br><span class="line">│   ├── models</span><br><span class="line">│   │   ├── res50-stage-1.pth</span><br><span class="line">│   │   ├── res50-stage-2.pth</span><br><span class="line">│   │   ├── res50-stage-3.pth</span><br><span class="line">│   │   ├── stage-1.pth</span><br><span class="line">│   │   ├── tmp.pth</span><br><span class="line">│   │   └── unfreeze-stage-1.pth</span><br><span class="line">│   ├── motogp [679 entries exceeds filelimit, not opening dir]</span><br><span class="line">│   ├── shooting [536 entries exceeds filelimit, not opening dir]</span><br><span class="line">│   ├── swimming [689 entries exceeds filelimit, not opening dir]</span><br><span class="line">│   ├── table_tennis [713 entries exceeds filelimit, not opening dir]</span><br><span class="line">│   ├── tennis [718 entries exceeds filelimit, not opening dir]</span><br><span class="line">│   ├── volleyball [713 entries exceeds filelimit, not opening dir]</span><br><span class="line">│   ├── weight_lifting [577 entries exceeds filelimit, not opening dir]</span><br><span class="line">│   ├── wrestling [611 entries exceeds filelimit, not opening dir]</span><br><span class="line">│   ├── wwe [671 entries exceeds filelimit, not opening dir]</span><br><span class="line">│   ├── badminton_urls.txt</span><br><span class="line">│   ├── baseball_urls.txt</span><br><span class="line">│   ├── basketball_urls.txt</span><br><span class="line">│   ├── boxing_urls.txt</span><br><span class="line">│   ├── chess_urls.txt</span><br><span class="line">│   ├── cleaned.csv</span><br><span class="line">│   ├── cricket_urls.txt</span><br><span class="line">│   ├── export.pkl</span><br><span class="line">│   ├── fencing_urls.txt</span><br><span class="line">│   ├── football_urls.txt</span><br><span class="line">│   ├── formula1_urls.txt</span><br><span class="line">│   ├── gymnastics_urls.txt</span><br><span class="line">│   ├── hockey_urls.txt</span><br><span class="line">│   ├── ice_hockey_urls.txt</span><br><span class="line">│   ├── kabaddi_urls.txt</span><br><span class="line">│   ├── motogp_urls.txt</span><br><span class="line">│   ├── shooting_urls.txt</span><br><span class="line">│   ├── swimming_urls.txt</span><br><span class="line">│   ├── table_tennis_urls.txt</span><br><span class="line">│   ├── tennis_urls.txt</span><br><span class="line">│   ├── volleyball_urls.txt</span><br><span class="line">│   ├── weight_lifting_urls.txt</span><br><span class="line">│   ├── wrestling_urls.txt</span><br><span class="line">│   └── wwe_urls.txt</span><br><span class="line">├── example_clips</span><br><span class="line">│   ├── lifting.mp4</span><br><span class="line">│   ├── soccer.mp4</span><br><span class="line">│   └── tennis.mp4</span><br><span class="line">├── model</span><br><span class="line">├── output</span><br><span class="line">│   ├── activity.model</span><br><span class="line">│   ├── lb.pickle</span><br><span class="line">│   ├── tennis_128frames_smoothened.avi</span><br><span class="line">│   ├── tennis_128frames_smoothened (convert-video-online.com).mp4</span><br><span class="line">│   └── tennis_1frame.avi</span><br><span class="line">├── Sports-Type-Classifier</span><br><span class="line">│   ├── readme_images</span><br><span class="line">│   │   ├── acc_sports.png</span><br><span class="line">│   │   ├── cric.png</span><br><span class="line">│   │   ├── heat_cric.png</span><br><span class="line">│   │   ├── si_sports.png</span><br><span class="line">│   │   ├── sports_confusion_matrix.png</span><br><span class="line">│   │   ├── sports_data_aug.png</span><br><span class="line">│   │   └── sports.png</span><br><span class="line">│   ├── README.md</span><br><span class="line">│   └── sports_classifier.ipynb</span><br><span class="line">├── plot.png</span><br><span class="line">├── predict_video.py</span><br><span class="line">├── sports_classifier.ipynb</span><br><span class="line">├── sports-type-classifier-data.7z</span><br><span class="line">├── sports-type-classifier-data.zip</span><br><span class="line">└── train.py</span><br><span class="line"></span><br><span class="line">29 directories, 53 files</span><br><span class="line">!python predict_video.py --model output&#x2F;activity.model \</span><br><span class="line">	--label-bin output&#x2F;lb.pickle \</span><br><span class="line">	--input example_clips&#x2F;lifting.mp4 \</span><br><span class="line">	--output output&#x2F;lifting_128frame.avi \</span><br><span class="line">	--size 128</span><br><span class="line">!python predict_video.py --model output&#x2F;activity.model \</span><br><span class="line">	--label-bin output&#x2F;lb.pickle \</span><br><span class="line">	--input example_clips&#x2F;tennis.mp4 \</span><br><span class="line">	--output output&#x2F;tennis_128frames_smoothened.avi \</span><br><span class="line">	--size 128</span><br></pre></td></tr></table></figure>
<h2 id="References"><a href="#References" class="headerlink" title="References"></a>References</h2><ol>
<li><a href="https://www.pyimagesearch.com/2019/07/15/video-classification-with-keras-and-deep-learning/" target="_blank" rel="noopener">https://www.pyimagesearch.com/2019/07/15/video-classification-with-keras-and-deep-learning/</a></li>
</ol>

    </div>

    
    
    
        

<div>
<ul class="post-copyright">
  <li class="post-copyright-author">
    <strong>本文作者： </strong>Chenyang Min
  </li>
  <li class="post-copyright-link">
    <strong>本文链接：</strong>
    <a href="https://perfectism13.github.io/2020/07/24/%E7%94%A8Keras%E5%AE%9E%E7%8E%B0%E8%A7%86%E9%A2%91%E5%8A%A8%E4%BD%9C%E5%88%86%E7%B1%BB/" title="用Keras实现视频动作分类">https://perfectism13.github.io/2020/07/24/用Keras实现视频动作分类/</a>
  </li>
  <li class="post-copyright-license">
    <strong>版权声明： </strong>本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/zh-CN" rel="noopener" target="_blank"><i class="fab fa-fw fa-creative-commons"></i>BY-NC-SA</a> 许可协议。转载请注明出处！
  </li>
</ul>
</div>


      <footer class="post-footer">

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2020/07/24/%E9%97%AE%E9%A2%98/" rel="prev" title="问题">
      <i class="fa fa-chevron-left"></i> 问题
    </a></div>
      <div class="post-nav-item">
    <a href="/2020/08/17/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E7%AE%97%E6%B3%95%20%E7%AC%94%E8%AE%B0/" rel="next" title="数据结构与算法 笔记">
      数据结构与算法 笔记 <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          
    <div class="comments" id="gitalk-container"></div>

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#用Keras实现视频动作分类"><span class="nav-text">用Keras实现视频动作分类</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#普通方法"><span class="nav-text">普通方法</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#使用滚动平均方法（rolling-prediction-average）"><span class="nav-text">使用滚动平均方法（rolling prediction average）</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#代码实现"><span class="nav-text">代码实现</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#前期准备"><span class="nav-text">前期准备</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#开始"><span class="nav-text">开始</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#用滚动预测平均的方式应用模型到视频分类中"><span class="nav-text">用滚动预测平均的方式应用模型到视频分类中</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#References"><span class="nav-text">References</span></a></li></ol></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">Chenyang Min</p>
  <div class="site-description" itemprop="description">Computer Vision, Deep Learning</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">26</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">4</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">6</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Chenyang Min</span>
</div>

        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <span class="post-meta-item" id="busuanzi_container_site_uv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="总访客量">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item" id="busuanzi_container_site_pv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="总访问量">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>

<script src="/js/bookmark.js"></script>




  




  
<script src="/js/local-search.js"></script>









<script>
document.querySelectorAll('.pdfobject-container').forEach(element => {
  let url = element.dataset.target;
  let pdfOpenParams = {
    navpanes : 0,
    toolbar  : 0,
    statusbar: 0,
    pagemode : 'thumbs',
    view     : 'FitH'
  };
  let pdfOpenFragment = '#' + Object.entries(pdfOpenParams).map(([key, value]) => `${key}=${encodeURIComponent(value)}`).join('&');
  let fullURL = `/lib/pdf/web/viewer.html?file=${encodeURIComponent(url)}${pdfOpenFragment}`;

  if (NexT.utils.supportsPDFs()) {
    element.innerHTML = `<embed class="pdfobject" src="${url + pdfOpenFragment}" type="application/pdf" style="height: ${element.dataset.height};">`;
  } else {
    element.innerHTML = `<iframe src="${fullURL}" style="height: ${element.dataset.height};" frameborder="0"></iframe>`;
  }
});
</script>




  

  

  

<link rel="stylesheet" href="//cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.css">

<script>
NexT.utils.loadComments(document.querySelector('#gitalk-container'), () => {
  NexT.utils.getScript('//cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js', () => {
    var gitalk = new Gitalk({
      clientID    : '809715bb1dc3b600fe38',
      clientSecret: '962bbbd3c02e9ff070497a47a3a7dc38e33d97f2',
      repo        : 'perfectism13.github.io',
      owner       : 'perfectism13',
      admin       : ['perfectism13'],
      id          : 'd7618d7746e5d7c0b2bc7edfee626ca7',
        language: 'zh-CN',
      distractionFreeMode: true
    });
    gitalk.render('gitalk-container');
  }, window.Gitalk);
});
</script>

</body>
</html>
